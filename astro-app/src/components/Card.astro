---
import { urlFor } from "../utils/image";
import type { Post } from "../utils/sanity";

interface Props {
  post: Post;
}

const { post } = Astro.props;
const firstCategory = post.categories && post.categories.length > 0 ? post.categories[0] : null;
const tags = post.tags || [];

const dateObj = new Date(post.publishedAt || post._createdAt);
const isToday = new Date().toDateString() === dateObj.toDateString();
const dateStr = dateObj.toLocaleDateString("en-US", { month: "long", day: "numeric" });
const displayDate = isToday ? "Today" : dateStr;
---

<article class="post-card-wrapper">
  <div class="post-meta">
      <span class="post-date">{displayDate}</span>
      {firstCategory && (
        <>
            <span class="post-meta-sep">â€¢</span>
            <span class="post-category">{firstCategory}</span>
        </>
      )}
  </div>

  <a href={`/post/${post.slug.current}`} class="card">
    <div class="card__visuals">
        {post.mainImage ? (
        <img
            class="card__cover"
            src={urlFor(post.mainImage).width(800).height(450).url()}
            alt={post.mainImage.alt || ""}
        />
        ) : (
        <div class="card__cover--none" />
        )}
        <div class="card__type-pill">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
            <span>Article</span>
        </div>
    </div>

    <div class="card__content">
        <h2 class="card__title">{post.title}</h2>
        <p class="card__excerpt">{post.excerpt}</p>
        
        {tags.length > 0 && (
            <div class="card__tags">
                {tags.map(tag => (
                    <span class="card__tag">{tag}</span>
                ))}
            </div>
        )}
    </div>
  </a>
</article>

<style>
  .post-card-wrapper {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin-bottom: 2.5rem;
    padding: 0 1.5rem;
  }

  .post-meta {
    font-family: var(--font-family-sans);
    font-size: 0.875rem;
    font-weight: 700;
    color: var(--black);
    display: flex;
    gap: 0.5rem;
    align-items: center;
    padding-left: 2px;
  }
  
  .post-meta-sep {
    color: var(--gray-600);
  }

  .post-category {
    text-decoration: underline;
    text-underline-offset: 2px;
  }

  .card {
    display: block;
    text-decoration: none;
    color: inherit;
    border: 1px solid var(--gray-200);
    border-radius: 12px;
    background: #fff;
    transition: all 0.2s ease;
    overflow: hidden;
  }

  .card:hover {
    border-color: var(--blue-600);
    transform: translateY(-2px);
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
  }

  .card__visuals {
    position: relative;
    width: 100%;
    aspect-ratio: 16/9;
    overflow: hidden;
    background: var(--gray-200);
  }

  .card__cover {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .card__cover--none {
    width: 100%;
    height: 100%;
    background: var(--gray-200);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .card__type-pill {
    position: absolute;
    bottom: 12px;
    left: 12px;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(4px);
    color: white;
    padding: 6px 10px;
    border-radius: 6px;
    font-size: 0.75rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 6px;
    line-height: 1;
  }

  .card__content {
    padding: 1.5rem;
  }

  .card__title {
    font-family: var(--font-family-sans);
    font-weight: 800;
    font-size: 1.5rem;
    line-height: 1.25;
    margin: 0 0 0.75rem 0;
    color: var(--black);
  }

  .card__excerpt {
    font-family: var(--font-family-sans);
    font-size: 1rem;
    line-height: 1.6;
    color: var(--gray-600);
    margin: 0 0 1.5rem 0;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .card__tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .card__tag {
    background: #F6F1E1;
    color: var(--black);
    padding: 6px 12px;
    border-radius: 9999px;
    font-size: 0.8125rem;
    font-weight: 500; /* Adjusted to 500 as 200 is not imported */
    background-color: #F6F1E1;
  }
</style>
